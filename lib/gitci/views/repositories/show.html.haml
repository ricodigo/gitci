%ul(class="breadcrumb")
  %li
    %a(href="/")
      Home
    %span(class="divider")
      \/
  %li(class="active")
    %a(href="/repositories/#{@repository.id}")
      Repository
      =@repository.name
%h1
  =@repository.name

%h2
  Git Repository
%a(href="#{@repository.uri}")
  =@repository.uri

-if @repository.has_gemfile
  %pre{:style => "background: #bbb"}
    =@repository.bundle_output

-if @repository.has_coverage
  %a(href="#{@repository.coverage_path}")
    coverage

%form(action="/repositories/#{@repository.id}/scripts" method="post" name="create-script-form" class="well")
  %label
    Name
  %input(type='text' name='script[name]')

  %label
    Description
  %textarea(name='script[description]' rows="5" class="span4")
  %label
    Command
  %textarea(name='script[command]' class="span4")
  .field.buttons
    %input(type='submit' value='Add script' class="btn")

%ul(class="nav nav-tabs")
  -@repository.scripts.order(:created_at.desc).each do |script|
    %li
      =h script.command
      %a(href="/repositories/#{@repository.id}/scripts/#{script.id}/run")
        run
      |
      %a(href="/repositories/#{@repository.id}/scripts/#{script.id}/delete")
        delete
      %ul
        -script.build_tasks.where(:running => true).order(:created_at.desc).limit(20).each do |task|
          %li
            =haml :"repositories/_task.html", :locals => {:task => task}

        -script.build_tasks.where(:performed => true).order(:created_at.desc).limit(20).each do |task|
          %li
            =haml :"repositories/_task.html", :locals => {:task => task}
